{% extends 'blog/base.html' %}
{% block content %}
<div class="card">
    <div class="card-body">
        <h5>@{{ post.author.username }}</h5>
        <p>{{ post.content }}</p>
        <small class="text-muted">{{ post.created_on|date:"d.m.Y H:i" }}</small>
        <div class="mt-2">
            <a href="{% url 'toggle_like' post.pk %}"
               class="btn btn-sm {% if user_has_liked %}btn-danger{% else %}btn-outline-danger{% endif %}">
                ❤️ {{ post.likes_count }}
            </a>
            Комментариев: {{ post.comments_count }}
        </div>
    </div>
</div>

<!-- Комментарии -->
<h4 class="mt-4">Комментарии</h4>
{% for comment in comments %}
    <div class="card mb-2">
        <div class="card-body">
            <strong>@{{ comment.author.username }}</strong>
            <p>{{ comment.content }}</p>
            {% if user == comment.author %}
                <a href="{% url 'comment_edit' comment.pk %}" class="btn btn-sm btn-outline-secondary">Изменить</a>
                <a href="{% url 'comment_delete' comment.pk %}" class="btn btn-sm btn-outline-danger">Удалить</a>
            {% endif %}
        </div>
    </div>
{% empty %}
    <p>Комментариев нет.</p>
{% endfor %}

<!-- Форма комментария -->
{% if user.is_authenticated %}
<form method="post" action="{% url 'add_comment' post.pk %}" class="mt-3">
    {% csrf_token %}
    <div class="mb-3">
        <textarea name="content" class="form-control" placeholder="Ваш комментарий..." required></textarea>
    </div>
    <button type="submit" class="btn btn-primary">Отправить</button>
</form>
{% endif %}

<!-- Кнопки управления постом -->
{% if user == post.author %}
    <div class="mt-3">
        <a href="{% url 'post_edit' post.pk %}" class="btn btn-warning">Изменить</a>
        <a href="{% url 'post_delete' post.pk %}" class="btn btn-danger">Удалить</a>
    </div>
{% endif %}
{% endblock %}